{% extends 'base.html' %}
{% block title %}{{ 'الموظفين' if lang == 'ar' else 'Employees' }}{% endblock %}
{% block content %}
<div class="row">
    <div class="col-12 mb-4">
        <h2 class="theme-color fw-bold text-center"><i class="bi bi-people"></i> {{ 'إدارة الموظفين' if lang == 'ar' else 'Employees Management' }}</h2>
    </div>
    <!-- Cards Row -->
    <div class="row g-4 mb-4">
        <div class="col-md-4 col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body text-center">
                    <span class="fs-1 text-primary"><i class="bi bi-people"></i></span>
                    <h6 class="mt-2">{{ 'عدد الموظفين' if lang == 'ar' else 'Total Employees' }}</h6>
                    <div class="display-6 fw-bold">{{ employees|length }}</div>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body text-center">
                    <span class="fs-1 text-success"><i class="bi bi-person-check"></i></span>
                    <h6 class="mt-2">{{ 'الموظفين النشطين' if lang == 'ar' else 'Active Employees' }}</h6>
                    <div class="display-6 fw-bold">{{ employees|selectattr('active')|list|length }}</div>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body text-center">
                    <span class="fs-1 text-danger"><i class="bi bi-person-x"></i></span>
                    <h6 class="mt-2">{{ 'غير النشطين' if lang == 'ar' else 'Inactive Employees' }}</h6>
                    <div class="display-6 fw-bold">{{ employees|rejectattr('active')|list|length }}</div>
                </div>
            </div>
        </div>
    </div>
    <!-- نموذج إضافة موظف جديد -->
    <div class="card mb-4">
        <div class="card-header bg-theme text-white fw-bold"><i class="bi bi-person-plus"></i> {{ 'إضافة موظف جديد' if lang == 'ar' else 'Add New Employee' }}</div>
        <div class="card-body">
            <form class="row g-2" method="POST">
                {{ form.hidden_tag() }}
                <div class="col-md-2">
                    {{ form.code(class_='form-control', placeholder=('الكود' if lang == 'ar' else 'Code')) }}
                </div>
                <div class="col-md-2">
                    {{ form.name(class_='form-control', placeholder=('الاسم' if lang == 'ar' else 'Name')) }}
                </div>
                <div class="col-md-2">
                    {{ form.job_title(class_='form-control', placeholder=('المسمى الوظيفي' if lang == 'ar' else 'Job Title')) }}
                </div>
                <div class="col-md-2">
                    {{ form.department(class_='form-select') }}
                </div>
                <div class="col-md-2">
                    {{ form.phone(class_='form-control', placeholder=('الهاتف' if lang == 'ar' else 'Phone')) }}
                </div>
                <div class="col-md-2">
                    {{ form.email(class_='form-control', placeholder=('البريد الإلكتروني' if lang == 'ar' else 'Email')) }}
                </div>
                <div class="col-md-2">
                    {{ form.salary(class_='form-control', placeholder=('الراتب' if lang == 'ar' else 'Salary')) }}
                </div>
                <div class="col-md-1">
                    {{ form.active(class_='form-select') }}
                </div>
                <div class="col-md-1">
                    <button class="btn bg-theme w-100" type="submit"><i class="bi bi-plus-lg"></i> {{ 'إضافة' if lang == 'ar' else 'Add' }}</button>
                </div>
            </form>
        </div>
    </div>
    <!-- بحث الموظفين -->
    <form class="d-flex mb-3" method="GET">
        <input type="text" name="search" class="form-control me-2" placeholder="{{ 'بحث' if lang == 'ar' else 'Search' }}">
        <button class="btn bg-theme" type="submit"><i class="bi bi-search"></i> {{ 'بحث' if lang == 'ar' else 'Search' }}</button>
    </form>
    <!-- جدول الموظفين -->
    <div class="card">
        <div class="card-header bg-theme text-white fw-bold"><i class="bi bi-table"></i> {{ 'قائمة الموظفين' if lang == 'ar' else 'Employees List' }}</div>
        <div class="card-body p-0">
            <table class="table table-bordered table-striped mb-0">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>{{ 'الكود' if lang == 'ar' else 'Code' }}</th>
                        <th>{{ 'الاسم' if lang == 'ar' else 'Name' }}</th>
                        <th>{{ 'المسمى الوظيفي' if lang == 'ar' else 'Job Title' }}</th>
                        <th>{{ 'القسم' if lang == 'ar' else 'Department' }}</th>
                        <th>{{ 'الهاتف' if lang == 'ar' else 'Phone' }}</th>
                        <th>{{ 'البريد الإلكتروني' if lang == 'ar' else 'Email' }}</th>
                        <th>{{ 'نشط' if lang == 'ar' else 'Active' }}</th>
                        <th>{{ 'الراتب' if lang == 'ar' else 'Salary' }}</th>
                        <th>{{ 'الإجراءات' if lang == 'ar' else 'Actions' }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in employees %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ emp.code }}</td>
                        <td><a href="/employee/{{ emp.id }}">{{ emp.name }}</a></td>
                        <td>{{ emp.job_title }}</td>
                        <td>{{ emp.department }}</td>
                        <td>{{ emp.phone }}</td>
                        <td>{{ emp.email }}</td>
                        <td>{{ 'نعم' if emp.active else 'لا' }}</td>
                        <td>{{ '{:,.2f}'.format(emp.salary) }} ج.م</td>
                        <td>
                            <a href="/employees/edit/{{ emp.id }}" class="btn btn-sm btn-warning">{{ 'تعديل' if lang == 'ar' else 'Edit' }}</a>
                            <a href="/admin/permissions#usersTab" class="btn btn-sm btn-info">{{ 'تعديل الصلاحية' if lang == 'ar' else 'Edit Role' }}</a>
                            <form method="POST" action="/employees/delete/{{ emp.id }}" style="display:inline;" onsubmit="return confirm('هل أنت متأكد من الحذف؟');">
                                {{ form.csrf_token }}
                                <button type="submit" class="btn btn-sm btn-danger">{{ 'حذف' if lang == 'ar' else 'Delete' }}</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
