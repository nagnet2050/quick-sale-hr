{% extends 'base.html' %}
{% block title %}حالة التواجد{% endblock %}
{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-6">
        <div class="card p-4 text-center">
            <h4>حالة التواجد</h4>
            <div id="presence-status">
                <span class="status-dot" id="status-dot"></span>
                <span id="status-text">جاري التحميل...</span>
            </div>
            <div id="last-activity" class="mt-2">آخر نشاط: جاري التحميل...</div>
        </div>
    </div>
</div>
<script>
function fetchPresenceStatus() {
    fetch('/api/presence/status/' + current_user_id)
        .then(res => res.json())
        .then(data => {
            let status = data.status;
            let last_activity = data.last_activity;
            let statusText = '';
            let dotClass = '';
            if (status === 'online') {
                statusText = 'متصل'; dotClass = 'online';
            } else if (status === 'away') {
                statusText = 'غير متاح'; dotClass = 'away';
            } else {
                statusText = 'غير متصل'; dotClass = 'offline';
            }
            document.getElementById('status-text').textContent = statusText;
            document.getElementById('status-dot').className = 'status-dot ' + dotClass;
            document.getElementById('last-activity').textContent = 'آخر نشاط: ' + (last_activity ? new Date(last_activity).toLocaleString('ar-EG') : 'غير متوفر');
        });
}
fetchPresenceStatus();
setInterval(fetchPresenceStatus, 60000);
</script>
<style>
.status-dot { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-left: 5px; }
.status-dot.online { background: #28a745; }
.status-dot.away { background: #ffc107; }
.status-dot.offline { background: #dc3545; }
</style>
{% endblock %}
