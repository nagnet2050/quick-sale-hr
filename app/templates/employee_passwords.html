{% extends 'base.html' %}

{% block title %}{{ 'إدارة كلمات المرور' if lang == 'ar' else 'Manage Passwords' }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="theme-color">
                <i class="fas fa-key"></i>
                {{ 'إدارة كلمات مرور الموظفين' if lang == 'ar' else 'Manage Employee Passwords' }}
            </h2>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h6>{{ 'إجمالي الموظفين' if lang == 'ar' else 'Total Employees' }}</h6>
                    <h3 id="totalEmployees">0</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h6>{{ 'لديهم كلمة مرور' if lang == 'ar' else 'With Password' }}</h6>
                    <h3 id="withPassword">0</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <h6>{{ 'بدون كلمة مرور' if lang == 'ar' else 'Without Password' }}</h6>
                    <h3 id="withoutPassword">0</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h6>{{ 'الموظفين النشطين' if lang == 'ar' else 'Active Employees' }}</h6>
                    <h3 id="activeEmployees">0</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="searchEmployee" 
                           placeholder="{{ 'ابحث باسم الموظف أو الكود...' if lang == 'ar' else 'Search by name or code...' }}">
                </div>
                <div class="col-md-3">
                    <select class="form-control form-select" id="filterDepartment">
                        <option value="">{{ 'كل الأقسام' if lang == 'ar' else 'All Departments' }}</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-control form-select" id="filterStatus">
                        <option value="">{{ 'كل الموظفين' if lang == 'ar' else 'All Employees' }}</option>
                        <option value="with_password">{{ 'لديهم كلمة مرور' if lang == 'ar' else 'With Password' }}</option>
                        <option value="without_password">{{ 'بدون كلمة مرور' if lang == 'ar' else 'Without Password' }}</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-secondary w-100" onclick="resetFilters()">
                        <i class="fas fa-redo"></i>
                        {{ 'إعادة تعيين' if lang == 'ar' else 'Reset' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Employees Table -->
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead class="bg-theme text-white">
                        <tr>
                            <th>{{ 'الكود' if lang == 'ar' else 'Code' }}</th>
                            <th>{{ 'الاسم' if lang == 'ar' else 'Name' }}</th>
                            <th>{{ 'القسم' if lang == 'ar' else 'Department' }}</th>
                            <th>{{ 'الوظيفة' if lang == 'ar' else 'Job Title' }}</th>
                            <th>{{ 'حالة كلمة المرور' if lang == 'ar' else 'Password Status' }}</th>
                            <th>{{ 'الحالة' if lang == 'ar' else 'Status' }}</th>
                            <th>{{ 'الإجراءات' if lang == 'ar' else 'Actions' }}</th>
                        </tr>
                    </thead>
                    <tbody id="employeesTableBody">
                        <tr>
                            <td colspan="7" class="text-center">
                                <i class="fas fa-spinner fa-spin"></i>
                                {{ 'جاري التحميل...' if lang == 'ar' else 'Loading...' }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Set/Change Password -->
<div class="modal fade" id="passwordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-theme text-white">
                <h5 class="modal-title">
                    <i class="fas fa-key"></i>
                    <span id="modalTitle">{{ 'تعيين كلمة المرور' if lang == 'ar' else 'Set Password' }}</span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <input type="hidden" id="employeeId" name="employee_id">
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>{{ 'الموظف' if lang == 'ar' else 'Employee' }}:</strong></label>
                        <p id="employeeInfo" class="text-muted"></p>
                    </div>

                    <div class="mb-3">
                        <label for="newPassword" class="form-label">{{ 'كلمة المرور الجديدة' if lang == 'ar' else 'New Password' }}</label>
                        <input type="password" class="form-control" id="newPassword" name="password" required minlength="4">
                        <small class="text-muted">{{ 'على الأقل 4 أحرف' if lang == 'ar' else 'Minimum 4 characters' }}</small>
                    </div>

                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">{{ 'تأكيد كلمة المرور' if lang == 'ar' else 'Confirm Password' }}</label>
                        <input type="password" class="form-control" id="confirmPassword" required minlength="4">
                    </div>

                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="showPassword">
                        <label class="form-check-label" for="showPassword">
                            {{ 'إظهار كلمة المرور' if lang == 'ar' else 'Show Password' }}
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                    {{ 'إلغاء' if lang == 'ar' else 'Cancel' }}
                </button>
                <button type="button" class="btn bg-theme" onclick="savePassword()">
                    <i class="fas fa-save"></i>
                    {{ 'حفظ' if lang == 'ar' else 'Save' }}
                </button>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/employee_passwords.js"></script>
{% endblock %}
