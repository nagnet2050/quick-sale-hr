# ๐ฏ ูุธุงู ุงูุญุถูุฑ ูุงูุงูุตุฑุงู ุงููุชุทูุฑ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุงูุญุถูุฑ ูุงูุงูุตุฑุงู ููุดูู **ุซูุงุซุฉ ูุณุชููุงุช ูู ุงูุชุญูู** ูุถูุงู ุฏูุฉ ูุฃูุงู ุชุณุฌูู ุงูุญุถูุฑ:

### โ ูุณุชููุงุช ุงูุชุญูู

1. **๐ ุงูุชุญูู ูู ุงููููุน (GPS Location)**
   - ูุชุญูู ูู ูุฌูุฏ ุงูููุธู ุฏุงุฎู ูุทุงู ูุนูู ูู ููุฑ ุงูุดุฑูุฉ
   - ูุญุณุจ ุงููุณุงูุฉ ุจูู ูููุน ุงูููุธู ููููุน ุงูุดุฑูุฉ
   - ูููู ุถุจุท ุงููุณุงูุฉ ุงููุณููุญุฉ (ุงูุชุฑุงุถูุงู: 100 ูุชุฑ)

2. **โฐ ุงูุชุญูู ูู ุงูููุช (Time Verification)**
   - ูุชุญูู ูู ุฃู ุงูุญุถูุฑ/ุงูุงูุตุฑุงู ุฎูุงู ุงูุฃููุงุช ุงููุญุฏุฏุฉ
   - ุฃููุงุช ุงูุญุถูุฑ ุงูุงูุชุฑุงุถูุฉ: 7:00 ุต - 10:00 ุต
   - ุฃููุงุช ุงูุงูุตุฑุงู ุงูุงูุชุฑุงุถูุฉ: 2:00 ู - 6:00 ู
   - ุฅููุงููุฉ ุงูุณูุงุญ ุจุงูุชุณุฌูู ุฎุงุฑุฌ ุงูุฃููุงุช ูุน ุชุญุฐูุฑ

3. **๐ป ุงูุชุญูู ูู ุงูุฌูุงุฒ (Device Fingerprinting)**
   - ูุญุฏุฏ ุงูุฌูุงุฒ ุงููุณุชุฎุฏู ุจุงุณุชุฎุฏุงู Device Fingerprinting
   - ูููู ุชุณุฌูู ุฃุฌูุฒุฉ ูุนููุฉ ููู ููุธู
   - ููุน ุงูุชุณุฌูู ูู ุฃุฌูุฒุฉ ุบูุฑ ูุณุฌูุฉ

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช

### ุงููุตูู ุฅูู ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช

**ุงููุณุงุฑ:** `/attendance/settings`  
**ุงูุตูุงุญูุงุช ุงููุทููุจุฉ:** Admin ููุท

### ุฅุนุฏุงุฏุงุช ุงููููุน

```
- ุฎุท ุงูุนุฑุถ (Latitude): ูููุน ุงูุดุฑูุฉ (ูุซุงู: 30.0444)
- ุฎุท ุงูุทูู (Longitude): ูููุน ุงูุดุฑูุฉ (ูุซุงู: 31.2357)
- ุงููุณุงูุฉ ุงููุณููุญุฉ: ุจุงููุชุฑ (ุงูุชุฑุงุถูุงู: 100 ูุชุฑ)
- ุชูุนูู/ุชุนุทูู ุงูุชุญูู ูู ุงููููุน
```

**ุฒุฑ "ุงุณุชุฎุฏุงู ูููุนู ุงูุญุงูู":** ูุญุฏุฏ ูููุนู ุงูุญุงูู ุชููุงุฆูุงู ููููุน ุงูุดุฑูุฉ

### ุฅุนุฏุงุฏุงุช ุงูููุช

```
ุฃููุงุช ุงูุญุถูุฑ:
- ูู: 07:00 (ูุงุจู ููุชุนุฏูู)
- ุฅูู: 10:00 (ูุงุจู ููุชุนุฏูู)

ุฃููุงุช ุงูุงูุตุฑุงู:
- ูู: 14:00 (ูุงุจู ููุชุนุฏูู)
- ุฅูู: 18:00 (ูุงุจู ููุชุนุฏูู)

ุฎูุงุฑุงุช:
โ ุชูุนูู ุงูุชุญูู ูู ุงูููุช
โ ุงูุณูุงุญ ุจุงูุชุณุฌูู ุฎุงุฑุฌ ุงูุฃููุงุช (ูุน ุชุญุฐูุฑ)
```

### ุฅุนุฏุงุฏุงุช ุงูุฃุฌูุฒุฉ

```
โ ุชูุนูู/ุชุนุทูู ุงูุชุญูู ูู ุงูุฌูุงุฒ
- ุนูุฏ ุงูุชูุนูู: ููุท ุงูุฃุฌูุฒุฉ ุงููุณุฌูุฉ ูููููุง ุงูุชุณุฌูู
```

---

## ๐ฑ ููููุฉ ุงุณุชุฎุฏุงู ุงููุธุงู

### ููููุธู

1. **ุชุณุฌูู ุงูุญุถูุฑ:**
   - ุงูุชุญ ุตูุญุฉ ุงูุญุถูุฑ
   - ุงุถุบุท ุนูู ุฒุฑ "ุญุถูุฑ"
   - ุงูุณูุงุญ ูููุชุตูุญ ุจุงููุตูู ุฅูู ุงููููุน
   - ุณูุธูุฑ ุฑุณุงูุฉ ุจุญุงูุฉ ุงูุชุณุฌูู ูุน ุชูุงุตูู ุงูุชุญูู

2. **ุชุณุฌูู ุงูุงูุตุฑุงู:**
   - ุงุถุบุท ุนูู ุฒุฑ "ุงูุตุฑุงู"
   - ุณูุชู ุงูุชุญูู ูู ุงููููุน ูุงูููุช ูุงูุฌูุงุฒ
   - ุณูุธูุฑ ุฑุณุงูุฉ ุงูุชุฃููุฏ

### ูููุฏูุฑ

1. **ุชุณุฌูู ุญุถูุฑ/ุงูุตุฑุงู ุงูููุธููู:**
   - ุงุฎุชุฑ ุงูููุธู ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
   - ุงุถุบุท ุนูู ุงูุฒุฑ ุงูููุงุณุจ

2. **ุถุจุท ุงูุฅุนุฏุงุฏุงุช:**
   - ูู ุตูุญุฉ ุงูุญุถูุฑุ ุงุถุบุท ุนูู "ุฅุนุฏุงุฏุงุช ุงูุญุถูุฑ"
   - ุนุฏูู ุงูุฅุนุฏุงุฏุงุช ุญุณุจ ุงูุญุงุฌุฉ
   - ุงุถุบุท "ุญูุธ ุงูุฅุนุฏุงุฏุงุช"

---

## ๐ ุฅุฏุงุฑุฉ ุงูุฃุฌูุฒุฉ ุงููุณุฌูุฉ

### ุชุณุฌูู ุฌูุงุฒ ุฌุฏูุฏ

**API Endpoint:** `POST /api/attendance/register-device`

```json
{
  "employee_id": 123,
  "mac_address": "00:11:22:33:44:55",
  "device_name": "Laptop - Ahmed",
  "device_info": "Windows 11 - Chrome 120"
}
```

### ุงูุญุตูู ุนูู ุฃุฌูุฒุฉ ููุธู

**API Endpoint:** `GET /api/attendance/devices/{employee_id}`

### ุญุฐู ุฌูุงุฒ

**API Endpoint:** `DELETE /api/attendance/device/{device_id}`

### ุชูุนูู/ุชุนุทูู ุฌูุงุฒ

**API Endpoint:** `POST /api/attendance/device/{device_id}/toggle`

---

## ๐ ุชูุงุตูู ุงูุชุญูู

ุนูุฏ ุชุณุฌูู ุงูุญุถูุฑ/ุงูุงูุตุฑุงูุ ูุญุตู ุงูููุธู ุนูู ุชูุงุตูู ูุงููุฉ ุนู ุญุงูุฉ ุงูุชุญูู:

```
ุชูุงุตูู ุงูุชุญูู:
๐ ุงููููุน: โ ุงููููุน ุตุญูุญ (ุงููุณุงูุฉ: 45 ูุชุฑ)
โฐ ุงูููุช: โ ุงูููุช ููุงุณุจ ููุญุถูุฑ
๐ป ุงูุฌูุงุฒ: โ ุงูุฌูุงุฒ ูุณุฌู: Laptop - Ahmed
```

---

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู attendance (ูุญุฏูุซ)

```sql
- mac_address (VARCHAR): ูุนุฑู ุงูุฌูุงุฒ
- device_info (VARCHAR): ูุนูููุงุช ุงูุฌูุงุฒ
- location_verified (BOOLEAN): ูู ุงููููุน ุตุญูุญุ
- time_verified (BOOLEAN): ูู ุงูููุช ุตุญูุญุ
- device_verified (BOOLEAN): ูู ุงูุฌูุงุฒ ูุณุฌูุ
- verification_notes (TEXT): ููุงุญุธุงุช ุงูุชุญูู
```

### ุฌุฏูู attendance_settings (ุฌุฏูุฏ)

```sql
- company_lat/lng: ูููุน ุงูุดุฑูุฉ
- max_distance_meters: ุงููุณุงูุฉ ุงููุณููุญุฉ
- check_in_start/end: ุฃููุงุช ุงูุญุถูุฑ
- check_out_start/end: ุฃููุงุช ุงูุงูุตุฑุงู
- require_*_verification: ุฎูุงุฑุงุช ุงูุชูุนูู
- allow_outside_hours: ุงูุณูุงุญ ุฎุงุฑุฌ ุงูุฃููุงุช
```

### ุฌุฏูู registered_device (ุฌุฏูุฏ)

```sql
- employee_id: ุงูููุธู
- mac_address: ูุนุฑู ุงูุฌูุงุฒ (ูุฑูุฏ)
- device_name: ุงุณู ุงูุฌูุงุฒ
- device_info: ูุนูููุงุช ุงูุฌูุงุฒ
- is_active: ููุนููุ
- registered_at: ุชุงุฑูุฎ ุงูุชุณุฌูู
- last_used: ุขุฎุฑ ุงุณุชุฎุฏุงู
```

---

## ๐๏ธ API Reference

### 1. ุชุณุฌูู ุงูุญุถูุฑ/ุงูุงูุตุฑุงู

**Endpoint:** `POST /api/attendance`

**Request Body:**
```json
{
  "action": "ุญุถูุฑ",
  "employee_id": 123,
  "lat": 30.0444,
  "lng": 31.2357,
  "address": "Cairo, Egypt",
  "mac_address": "a1:b2:c3:d4:e5:f6",
  "device_info": "Windows 11 - Chrome"
}
```

**Success Response:**
```json
{
  "status": "success",
  "message": "ุชู ุชุณุฌูู ุงูุญุถูุฑ ุจูุฌุงุญ",
  "verification_details": {
    "location": {
      "verified": true,
      "message": "ุงููููุน ุตุญูุญ (ุงููุณุงูุฉ: 45 ูุชุฑ)"
    },
    "time": {
      "verified": true,
      "message": "ุงูููุช ููุงุณุจ ููุญุถูุฑ"
    },
    "device": {
      "verified": true,
      "message": "ุงูุฌูุงุฒ ูุณุฌู: Laptop"
    }
  }
}
```

**Error Response:**
```json
{
  "status": "error",
  "message": "ูุดู ุงูุชุญูู ูู ุงููููุน: ุงููููุน ุจุนูุฏ ุนู ุงูุดุฑูุฉ (ุงููุณุงูุฉ: 500 ูุชุฑุ ุงููุณููุญ: 100 ูุชุฑ)",
  "verification_details": { ... }
}
```

### 2. ุงูุญุตูู ุนูู ุงูุฅุนุฏุงุฏุงุช

**Endpoint:** `GET /api/attendance/settings`

### 3. ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช

**Endpoint:** `POST /api/attendance/settings`

---

## ๐จ Device Fingerprinting

ูุธุฑุงู ูุฃู JavaScript ูุง ูููููุง ุงููุตูู ุงููุจุงุดุฑ ูู MAC Addressุ ูุณุชุฎุฏู **Device Fingerprinting** ุงูุฐู ูุฌูุน:

```javascript
- User Agent
- Platform (OS)
- Screen Resolution
- Language
- Timezone
- Canvas Fingerprint
```

ูุชู ุฏูุฌ ูุฐู ุงููุนูููุงุช ูุชุดููุฑูุง ุจู SHA-256 ูุฅูุดุงุก ูุนุฑู ูุฑูุฏ ููุฌูุงุฒ.

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ุณููุงุฑูู 1: ููุธู ูุณุฌู ุญุถูุฑ ุทุจูุนู
```
โ ุงููููุน: ุฏุงุฎู ุงููุทุงู (50 ูุชุฑ)
โ ุงูููุช: 8:30 ุต (ุถูู 7:00-10:00)
โ ุงูุฌูุงุฒ: ูุณุฌู
โ ุงููุชูุฌุฉ: ุชู ุงูุชุณุฌูู ุจูุฌุงุญ
```

### ุณููุงุฑูู 2: ููุธู ูุชุฃุฎุฑ
```
โ ุงููููุน: ุฏุงุฎู ุงููุทุงู
โ ุงูููุช: 10:30 ุต (ุฎุงุฑุฌ 7:00-10:00)
โ ุงูุฌูุงุฒ: ูุณุฌู
โ ุงููุชูุฌุฉ: ุฑูุถ (ุฅูุง ุฅุฐุง ูุงู allow_outside_hours ููุนู)
```

### ุณููุงุฑูู 3: ููุธู ูู ุฌูุงุฒ ุฌุฏูุฏ
```
โ ุงููููุน: ุฏุงุฎู ุงููุทุงู
โ ุงูููุช: ุตุญูุญ
โ ุงูุฌูุงุฒ: ุบูุฑ ูุณุฌู
โ ุงููุชูุฌุฉ: ุฑูุถ (ุฅุฐุง ูุงู require_device_verification ููุนู)
```

---

## ๐ ุงูููุฒุงุช ุงููุชูุฏูุฉ

1. **ุญุณุงุจ ุงููุณุงูุฉ ุงูุฏููู:** ุจุงุณุชุฎุฏุงู Haversine Formula
2. **ุฑุณุงุฆู ุชูุถูุญูุฉ:** ูู ุนูููุฉ ุชุญูู ุชุนุทู ุฑุณุงูุฉ ููุตูุฉ
3. **ูุฑููุฉ ุงูุฅุนุฏุงุฏุงุช:** ูููู ุชูุนูู/ุชุนุทูู ุฃู ููุน ูู ุงูุชุญูู
4. **ุงูุณูุงุญ ุจุงูุงุณุชุซูุงุกุงุช:** ุงูุณูุงุญ ุจุงูุชุณุฌูู ุฎุงุฑุฌ ุงูุฃููุงุช ูุน ุชุณุฌูู ููุงุญุธุฉ
5. **ุณุฌู ูุงูู:** ูู ุชุณุฌูู ูุญูุธ ูุชุงุฆุฌ ุงูุชุญูู ุงูุซูุงุซุฉ

---

## ๐ ุงูุชุซุจูุช ูุงูุชุญุฏูุซ

### ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
python upgrade_attendance.py
```

ูุฐุง ุงูุณูุฑูุจุช ุณูุถูู:
- โ 6 ุฃุนูุฏุฉ ุฌุฏูุฏุฉ ูุฌุฏูู attendance
- โ ุฌุฏูู attendance_settings
- โ ุฌุฏูู registered_device
- โ Indexes ููุฃุฏุงุก ุงูุฃูุซู

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฎุตูุตูุฉ:** Device Fingerprinting ูุง ููุดู ูุนูููุงุช ุดุฎุตูุฉุ ููุท ูุนุฑู ูุฑูุฏ ููุฌูุงุฒ
2. **ุงูุฃูุงู:** ูู ุงูุฅุนุฏุงุฏุงุช ูุญููุฉ ุจุตูุงุญูุงุช Admin
3. **ุงููุฑููุฉ:** ูููู ุชุนุทูู ุฃู ููุน ูู ุงูุชุญูู ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุดุฑูุฉ
4. **ุงูุชูุงูู:** ูุนูู ุนูู ูู ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ ุงูุชู ุชุฏุนู Geolocation API

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูููู ุงูุญุตูู ุนูู ุงููููุน
**ุงูุญู:** ุชุฃูุฏ ูู ููุญ ุงููุชุตูุญ ุฅุฐู ุงููุตูู ูููููุน

### ุงููุดููุฉ: ุงููููุน ุจุนูุฏ ุฌุฏุงู
**ุงูุญู:** ุฒูุงุฏุฉ max_distance_meters ูู ุงูุฅุนุฏุงุฏุงุช

### ุงููุดููุฉ: ูุง ูููู ุงูุชุณุฌูู ุฎุงุฑุฌ ุงูุฃููุงุช
**ุงูุญู:** ุชูุนูู allow_outside_hours ูู ุงูุฅุนุฏุงุฏุงุช

### ุงููุดููุฉ: ุฑูุถ ุงูุฌูุงุฒ
**ุงูุญู:** 
1. ุชุณุฌูู ุงูุฌูุงุฒ ุนุจุฑ API
2. ุฃู ุชุนุทูู require_device_verification

---

ุชู ุชุทููุฑ ุงููุธุงู ุจูุงุณุทุฉ GitHub Copilot ๐ค
