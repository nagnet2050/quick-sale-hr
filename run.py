from app import create_app
import subprocess
import sys
import os

def auto_upgrade_database():
    """ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„"""
    try:
        print("\n" + "="*60)
        print("ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...")
        print("="*60)
        
        # ØªØ´ØºÙŠÙ„ flask db upgrade
        result = subprocess.run(
            ['flask', 'db', 'upgrade'],
            capture_output=True,
            text=True,
            cwd=os.path.dirname(os.path.abspath(__file__))
        )
        
        if result.returncode == 0:
            print("âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­!")
            if result.stdout:
                # Ø¹Ø±Ø¶ ÙÙ‚Ø· Ø§Ù„Ø³Ø·ÙˆØ± Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ù† Ø§Ù„Ø®Ø±Ø¬
                for line in result.stdout.split('\n'):
                    if 'Running upgrade' in line or 'Context impl' in line:
                        print(f"   {line.strip()}")
        else:
            print("âš ï¸ ØªØ­Ø°ÙŠØ±: Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
            if result.stderr:
                print(result.stderr)
        
        print("="*60 + "\n")
        
    except FileNotFoundError:
        print("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ flask ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø±")
        print("   ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©")
    except Exception as e:
        print(f"âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {str(e)}")

app = create_app()

if __name__ == '__main__':
    # ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„
    # auto_upgrade_database()  # Ù…Ø¹Ø·Ù„ Ù…Ø¤Ù‚ØªØ§Ù‹ Ø¨Ø³Ø¨Ø¨ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ±Ø­ÙŠÙ„
    
    # ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    app.run(debug=True)
